<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000">
  <meta name="format-detection" content="telephone=no">
  <link rel="manifest" id="manifest">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' font-size='50' fill='%23ff9f0a' font-family='Arial' font-weight='bold' text-anchor='middle' dominant-baseline='middle'%3EC%3C/text%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' rx='40' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' font-size='85' fill='%23ff9f0a' font-family='Arial' font-weight='bold' text-anchor='middle' dominant-baseline='middle'%3EC%3C/text%3E%3C/svg%3E">
  <title>Calculator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
    }

    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      position: fixed;
      overscroll-behavior: none;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      touch-action: manipulation;
    }

    .calculator {
      width: 100%;
      max-width: 390px;
      background: #000;
      padding: 20px;
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-height: 844px;
    }

    .display {
      color: #fff;
      font-size: 80px;
      font-weight: 200;
      text-align: right;
      padding: 40px 20px 20px;
      flex: 1;
      display: flex;
      align-items: flex-end;
      justify-content: flex-end;
      word-wrap: break-word;
      word-break: break-all;
      line-height: 1;
      min-height: 120px;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 20px 0;
    }

    button {
      aspect-ratio: 1;
      border: none;
      border-radius: 50%;
      font-size: 32px;
      font-weight: 400;
      cursor: pointer;
      transition: all 0.1s;
      outline: none;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    button:active {
      filter: brightness(1.2);
      transform: scale(0.95);
    }

    .num, .zero {
      background: #333;
      color: #fff;
    }

    .operator {
      background: #ff9f0a;
      color: #fff;
      font-size: 40px;
    }

    .operator.active {
      background: #fff;
      color: #ff9f0a;
    }

    .function {
      background: #a5a5a5;
      color: #000;
      font-size: 28px;
    }

    .zero {
      grid-column: span 2;
      border-radius: 50px;
      aspect-ratio: 2.2 / 1;
      text-align: left;
      padding-left: 32px;
    }

    .install-prompt {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 15px 25px;
      border-radius: 25px;
      font-size: 14px;
      display: none;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .install-prompt button {
      background: #ff9f0a;
      color: #fff;
      border: none;
      padding: 8px 20px;
      border-radius: 15px;
      font-size: 14px;
      cursor: pointer;
      aspect-ratio: auto;
    }

    .install-prompt .close {
      background: transparent;
      color: #999;
      padding: 0;
      width: 30px;
      height: 30px;
      font-size: 20px;
    }

    @media (min-width: 768px) and (max-width: 1024px) {
      .calculator {
        max-width: 450px;
        max-height: 900px;
      }
      
      .display {
        font-size: 90px;
      }
      
      button {
        font-size: 36px;
      }
      
      .operator {
        font-size: 44px;
      }
      
      .function {
        font-size: 32px;
      }
    }

    @media (max-width: 380px) {
      .calculator {
        padding: 15px;
      }
      
      .display {
        font-size: 64px;
        padding: 30px 15px 15px;
      }
      
      button {
        font-size: 26px;
      }
      
      .operator {
        font-size: 34px;
      }
      
      .function {
        font-size: 24px;
      }
      
      .buttons {
        gap: 10px;
      }
      
      .zero {
        padding-left: 26px;
      }
    }

    @media (max-width: 320px) {
      .display {
        font-size: 56px;
      }
      
      button {
        font-size: 24px;
      }
      
      .operator {
        font-size: 30px;
      }
      
      .function {
        font-size: 22px;
      }
      
      .buttons {
        gap: 8px;
      }
    }

    @media (min-width: 400px) and (max-width: 480px) {
      .calculator {
        max-width: 420px;
      }
      
      .display {
        font-size: 85px;
      }
      
      button {
        font-size: 34px;
      }
      
      .operator {
        font-size: 42px;
      }
      
      .function {
        font-size: 30px;
      }
    }

    @media (min-width: 600px) and (max-width: 767px) {
      .calculator {
        max-width: 480px;
      }
      
      .display {
        font-size: 90px;
      }
    }

    @media (orientation: landscape) and (max-height: 500px) {
      .calculator {
        max-height: 100vh;
        padding: 10px;
      }
      
      .display {
        min-height: 80px;
        padding: 20px 15px 10px;
        font-size: 56px;
      }
      
      .buttons {
        padding: 10px 0;
        gap: 8px;
      }
      
      button {
        font-size: 24px;
      }
      
      .operator {
        font-size: 30px;
      }
      
      .function {
        font-size: 22px;
      }
    }

    @media (hover: hover) {
      button:hover {
        filter: brightness(1.1);
      }
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div class="display" id="display">0</div>
    <div class="buttons">
      <button class="function" data-action="clear">AC</button>
      <button class="function" data-action="sign">+/-</button>
      <button class="function" data-action="percent">%</button>
      <button class="operator" data-action="divide">÷</button>
      
      <button class="num" data-number="7">7</button>
      <button class="num" data-number="8">8</button>
      <button class="num" data-number="9">9</button>
      <button class="operator" data-action="multiply">×</button>
      
      <button class="num" data-number="4">4</button>
      <button class="num" data-number="5">5</button>
      <button class="num" data-number="6">6</button>
      <button class="operator" data-action="subtract">−</button>
      
      <button class="num" data-number="1">1</button>
      <button class="num" data-number="2">2</button>
      <button class="num" data-number="3">3</button>
      <button class="operator" data-action="add">+</button>
      
      <button class="zero" data-number="0">0</button>
      <button class="num" data-action="decimal">.</button>
      <button class="operator" data-action="equals">=</button>
    </div>
  </div>

  <div class="install-prompt" id="installPrompt">
    <span>Install Calculator app?</span>
    <button id="installBtn">Install</button>
    <button class="close" id="closePrompt">✕</button>
  </div>

  <script>
    // Generate manifest dynamically
    const manifestData = {
      name: "Calculator",
      short_name: "Calc",
      description: "Simple Calculator App",
      start_url: "./",
      display: "standalone",
      background_color: "#000000",
      theme_color: "#000000",
      orientation: "portrait",
      icons: [
        {
          src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='120' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' font-size='240' fill='%23ff9f0a' font-family='Arial' font-weight='bold' text-anchor='middle' dominant-baseline='middle'%3EC%3C/text%3E%3C/svg%3E",
          sizes: "512x512",
          type: "image/svg+xml",
          purpose: "any maskable"
        },
        {
          src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' rx='45' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' font-size='90' fill='%23ff9f0a' font-family='Arial' font-weight='bold' text-anchor='middle' dominant-baseline='middle'%3EC%3C/text%3E%3C/svg%3E",
          sizes: "192x192",
          type: "image/svg+xml"
        }
      ]
    };

    const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
    const manifestURL = URL.createObjectURL(manifestBlob);
    document.getElementById('manifest').setAttribute('href', manifestURL);

    // PWA Install Prompt
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installPrompt').style.display = 'flex';
    });

    document.getElementById('installBtn').addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        deferredPrompt = null;
        document.getElementById('installPrompt').style.display = 'none';
      }
    });

    document.getElementById('closePrompt').addEventListener('click', () => {
      document.getElementById('installPrompt').style.display = 'none';
    });

    // Calculator Logic
    const calc = {
      displayValue: '0',
      firstOperand: null,
      waitingForSecondOperand: false,
      operator: null,
      
      inputNumber(num) {
        if (this.waitingForSecondOperand) {
          this.displayValue = num;
          this.waitingForSecondOperand = false;
        } else {
          this.displayValue = this.displayValue === '0' ? num : this.displayValue + num;
        }
        this.updateDisplay();
      },
      
      inputDecimal() {
        if (this.waitingForSecondOperand) {
          this.displayValue = '0.';
          this.waitingForSecondOperand = false;
          this.updateDisplay();
          return;
        }
        
        if (!this.displayValue.includes('.')) {
          this.displayValue += '.';
          this.updateDisplay();
        }
      },
      
      clear() {
        this.displayValue = '0';
        this.firstOperand = null;
        this.waitingForSecondOperand = false;
        this.operator = null;
        this.clearActiveOperator();
        this.updateDisplay();
      },
      
      toggleSign() {
        this.displayValue = String(parseFloat(this.displayValue) * -1);
        this.updateDisplay();
      },
      
      percent() {
        this.displayValue = String(parseFloat(this.displayValue) / 100);
        this.updateDisplay();
      },
      
      setOperation(nextOperator) {
        const inputValue = parseFloat(this.displayValue);
        
        if (this.firstOperand === null && !isNaN(inputValue)) {
          this.firstOperand = inputValue;
        } else if (this.operator) {
          const result = this.performCalculation();
          this.displayValue = String(result);
          this.firstOperand = result;
        }
        
        this.waitingForSecondOperand = true;
        this.operator = nextOperator;
        this.updateDisplay();
        this.setActiveOperator(nextOperator);
      },
      
      calculate() {
        const inputValue = parseFloat(this.displayValue);
        
        if (this.operator && !this.waitingForSecondOperand) {
          const result = this.performCalculation();
          this.displayValue = String(result);
          this.firstOperand = result;
          this.operator = null;
          this.waitingForSecondOperand = true;
          this.clearActiveOperator();
          this.updateDisplay();
        }
      },
      
      performCalculation() {
        const first = this.firstOperand;
        const second = parseFloat(this.displayValue);
        
        if (this.operator === '+') return first + second;
        if (this.operator === '−') return first - second;
        if (this.operator === '×') return first * second;
        if (this.operator === '÷') return first / second;
        
        return second;
      },
      
      updateDisplay() {
        const display = document.getElementById('display');
        let value = this.displayValue;
        
        if (value.length > 9) {
          const num = parseFloat(value);
          if (Math.abs(num) > 999999999 || (Math.abs(num) < 0.000001 && num !== 0)) {
            value = num.toExponential(5);
          } else {
            value = value.substring(0, 9);
          }
        }
        
        display.textContent = value;
        
        const screenWidth = window.innerWidth;
        let baseFontSize = 80;
        
        if (screenWidth <= 320) baseFontSize = 56;
        else if (screenWidth <= 380) baseFontSize = 64;
        else if (screenWidth >= 768) baseFontSize = 90;
        
        if (value.length > 6) {
          display.style.fontSize = (baseFontSize * 0.75) + 'px';
        } else {
          display.style.fontSize = baseFontSize + 'px';
        }
      },
      
      setActiveOperator(op) {
        this.clearActiveOperator();
        const buttons = document.querySelectorAll('.operator');
        buttons.forEach(btn => {
          if (btn.textContent === op) {
            btn.classList.add('active');
          }
        });
      },
      
      clearActiveOperator() {
        const buttons = document.querySelectorAll('.operator');
        buttons.forEach(btn => btn.classList.remove('active'));
      }
    };

    // Event Delegation
    document.querySelector('.buttons').addEventListener('click', (e) => {
      const btn = e.target;
      if (!btn.matches('button')) return;

      const number = btn.dataset.number;
      const action = btn.dataset.action;

      if (number !== undefined) {
        calc.inputNumber(number);
      } else if (action) {
        switch(action) {
          case 'clear': calc.clear(); break;
          case 'sign': calc.toggleSign(); break;
          case 'percent': calc.percent(); break;
          case 'decimal': calc.inputDecimal(); break;
          case 'add': calc.setOperation('+'); break;
          case 'subtract': calc.setOperation('−'); break;
          case 'multiply': calc.setOperation('×'); break;
          case 'divide': calc.setOperation('÷'); break;
          case 'equals': calc.calculate(); break;
        }
      }
    });

    // Keyboard support
    document.addEventListener('keydown', (e) => {
      if (e.key >= '0' && e.key <= '9') calc.inputNumber(e.key);
      if (e.key === '.') calc.inputDecimal();
      if (e.key === '+') calc.setOperation('+');
      if (e.key === '-') calc.setOperation('−');
      if (e.key === '*') calc.setOperation('×');
      if (e.key === '/') { e.preventDefault(); calc.setOperation('÷'); }
      if (e.key === 'Enter' || e.key === '=') calc.calculate();
      if (e.key === 'Escape' || e.key === 'c') calc.clear();
      if (e.key === '%') calc.percent();
    });

    // Prevent zoom on double tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // Prevent context menu on long press
    document.addEventListener('contextmenu', (e) => {
      e.preventDefault();
    }, false);

    // Update display on orientation change
    window.addEventListener('orientationchange', () => {
      setTimeout(() => calc.updateDisplay(), 100);
    });

    // Update display on resize
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        calc.updateDisplay();
      }, 100);
    });

    // Register Service Worker for offline support
    if ('serviceWorker' in navigator) {
      // Create service worker inline
      const swCode = `
        self.addEventListener('install', (e) => {
          self.skipWaiting();
        });
        
        self.addEventListener('activate', (e) => {
          e.waitUntil(self.clients.claim());
        });
        
        self.addEventListener('fetch', (e) => {
          e.respondWith(
            fetch(e.request).catch(() => {
              return new Response('App works offline', {
                headers: { 'Content-Type': 'text/plain' }
              });
            })
          );
        });
      `;
      
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swURL = URL.createObjectURL(blob);
      
      navigator.serviceWorker.register(swURL)
        .then(() => console.log('✅ Offline mode enabled'))
        .catch((err) => console.log('Service Worker failed:', err));
    }
  </script>
</body>
  </html>
